# 记忆功能实现变更摘要

## 1. 扩展用户设置

在 `src/utils/user_settings.py` 中：
- 扩展了 DEFAULT_SETTINGS 字典，添加了更多默认设置项
- 增加了素材列表、文件夹抽取模式、界面状态等设置项
- 组织了设置项分类，包括导入素材设置、输出目录设置、视频参数设置、水印设置、音频设置、批量处理设置、缓存设置和界面状态等

## 2. 增强保存设置功能

在 `src/ui/main_window.py` 中修改了 `_save_user_settings` 方法：
- 保存窗口大小和位置
- 保存当前活动的标签页
- 保存素材列表数据，包括文件夹路径和拼接模式
- 保存各种UI界面设置（分辨率、比特率、转场效果、GPU设置等）
- 保存水印设置和音频设置
- 保存缓存目录

## 3. 增强加载设置功能

在 `src/ui/main_window.py` 中修改了 `_load_user_settings` 方法：
- 恢复窗口大小和位置
- 恢复活动标签页
- 自动加载上次的素材列表，检查路径有效性
- 恢复每个文件夹的拼接模式
- 恢复缓存目录设置
- 恢复所有其他界面设置

## 4. 增加自动保存触发点

在以下方法中添加了对 `_save_user_settings` 的调用：
- `on_add_material`：添加素材时保存设置
- `on_batch_import`：批量导入素材时保存设置
- `on_refresh_material`：刷新素材列表时保存设置
- `on_clear_material`：清空素材列表时保存设置
- `_on_table_cell_clicked`：修改拼接模式时保存设置
- `_show_folder_context_menu`：右键菜单修改拼接模式时保存设置

## 5. 文档和注释

- 创建了 `README_记忆功能使用说明.txt` 文件，详细说明记忆功能的使用
- 在代码中添加了注释，解释功能实现逻辑

## 关键特性

1. **自动记忆上次路径**：下次打开软件时自动记住上次导入的文件夹路径
2. **记住拼接模式**：每个文件夹的拼接模式（单视频或多视频拼接）会被保存和恢复
3. **记住所有设置**：包括视频参数、水印设置、音频设置等所有参数都会被保存
4. **智能路径处理**：只保存有效路径，如果路径不再有效会自动跳过
5. **不自动扫描**：仅记忆设置，不会在启动时扫描文件夹内容，保持启动速度

## 注意事项

1. 配置文件存储在用户目录下的 `VideoMixTool/user_settings.json`
2. 如果设置出现问题，会自动创建备份并使用默认设置
3. 所有设置修改都会立即保存，即使意外关闭也不会丢失 